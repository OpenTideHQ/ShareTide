name: Files retrieved via SMB connection
criticality: High
references:
  public:
    1: https://www.malwarebytes.com/blog/news/2018/12/how-threat-actors-are-using-smb-vulnerabilities
    2: https://www.makeuseof.com/what-is-smb-protocol-and-what-are-its-risks/
    3: https://twitter.com/r00tbsd/status/1679042071477338114
    4: https://blogs.blackberry.com/en/2023/07/romcom-targets-ukraine-nato-membership-talks-at-nato-summit
  #internal:
    #a: 
  #restricted:
    #A: 
  #reports:
    #-

metadata:
  uuid: f79a55a2-95bf-446d-a667-1bcf00f1b9f1
  schema: tvm::2.0
  tlp: clear
  version: 2
  created: 2023-07-17
  modified: 2023-10-06
  organisation:
    uuid: 56b0a0f0-b0bc-47d9-bb46-02f80ae2065a
    name: EC DIGIT CSOC

threat:
  actors:
    - name: att&ck::G0016 #[Enterprise] APT29, Blue Kitsune, Cozy Bear, CozyDuke, Dark Halo, IRON HEMLOCK, IRON RITUAL, Midnight Blizzard, NOBELIUM, NobleBaron, SolarStorm, The Dukes, UNC2452, UNC3524, YTTRIUM
    - name: misp::2ee5ed7a-c4d0-40be-a837-20817474a15b #UNC2452, DarkHalo, StellarParticle, NOBELIUM, Solar Phoenix, Midnight Blizzard
    - name: att&ck::G0108 #[Enterprise] Blue Mockingbird
    - name: att&ck::G0096 #[Enterprise] APT41, BARIUM, Brass Typhoon, Wicked Panda
    - name: misp::9c124874-042d-48cd-b72b-ccdc51ecbbd6 #APT41, G0096, TA415, Blackfly, Grayfly, LEAD, BARIUM, WICKED SPIDER, WICKED PANDA, BRONZE ATLAS, BRONZE EXPORT, Red Kelpie, G0044, Earth Baku, Amoeba, HOODOO, Brass Typhoon, Winnti, Double Dragon, TG-2633
    - name: att&ck::G0007 #[Enterprise] APT28, FROZENLAKE, Fancy Bear, Forest Blizzard, Group 74, IRON TWILIGHT, Pawn Storm, SNAKEMACKEREL, STRONTIUM, Sednit, Sofacy, Swallowtail, TG-4127, Threat Group-4127, Tsar Team
    - name: misp::5b4ee3ea-eee3-4c8e-8323-85ae32658754 #APT28, Pawn Storm, FANCY BEAR, Sednit, SNAKEMACKEREL, Tsar Team, TG-4127, STRONTIUM, Swallowtail, IRON TWILIGHT, Group 74, SIG40, Grizzly Steppe, G0007, ATK5, Fighting Ursa, ITG05, Blue Athena, TA422, T-APT-12, APT-C-20, UAC-0028, FROZENLAKE, Sofacy, Forest Blizzard, BlueDelta, Fancy Bear, GruesomeLarch
  killchain: Delivery #Can also be Lateral Movement if file are coming from another compromised device, to update in future
  att&ck:
    - T1570
    - T1021.002
    - T1021.007
  domains:
    - Enterprise
  terrain: |
    Iniating a SMB connection requires a valid user account which imply
    that the endpoint is already infected.
  targets:
    - Desktop
    - Laptop
    - Workstations
    - Public-Facing Servers
    - Web Application Servers
  platforms:
    - Windows
    - Office 365
  severity: Moderate incident
  leverage:
    - Dwelling
    - Software installation
    - Elevation of privilege
  impact:
    - Impairement
  viability: Likely
  description: | #Once TVM chaining is speced up, would be interesting to revisit and break down further
      
      ### The SMB Protocol
      SMB stands for Server Message Block. It is a network protocol used to 
      share data between computers and devices on a local or wide area network. 
      The protocol allows local network computers to interact with file shares.

      Threat actors frequently exploit SMB for their nefarious activities. 
      One common tactic involves leveraging SMB to interact with file shares, including Microsoft Sharepoints, OneDrive or some NAS servers. 
      In doing so, adversaries can pull malicious files from compromised endpoints, 
      paving the way for the execution of additional malicious code. 
      This method poses a significant threat, as it allows for the clandestine transfer of harmful files between systems, 
      thereby supporting lateral movement within the network. 
      Threat actors may exploit inherent file sharing protocols like SMB/Windows Admin Shares, 
      either to connected network shares or through authenticated connections via Remote Desktop Protocol.
      
      Moreover, the embedding of files can serve as a vector for initiating SMB connections. 
      For instance, embedded files containing links executed by Office applications may establish 
      connections with SMB servers under the threat actor's control. This technique allows threat actors to exploit unsuspecting users, 
      initiating SMB connections that may lead to the execution of malicious code.
      
      In a more advanced scenario, threat actors might specify a malicious server, 
      directing the SMB protocol to facilitate further code execution. 
      This strategic move enables them to retrieve various types of files, potentially leading to widespread infection across entire machines within the network. 
      The ability to specify a malicious server amplifies the threat, 
      as it allows threat actors to exercise greater control over the execution and distribution of harmful payloads, posing a severe risk to the overall security of the network.
