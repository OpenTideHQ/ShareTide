name: Resource Secret Reveal in Azure
criticality: High
references:
  public:
    1: https://microsoft.github.io/Azure-Threat-Research-Matrix/CredentialAccess/AZT605/AZT605/
    2: https://learn.microsoft.com/en-us/azure/defender-for-cloud/secrets-scanning
  #internal:
    #a: 

metadata:
  uuid: 37381f28-ad9f-40c3-80f8-d8a82d6ce9a3
  schema: tvm::2.1
  version: 1
  created: 2025-09-15
  modified: 2025-09-15
  tlp: clear
  #author: 
  #contributors:
    #-
  organisation:
    uuid: 56b0a0f0-b0bc-47d9-bb46-02f80ae2065a
    name: EC DIGIT CSOC

threat:
  #actors:
    #- name: 
      #sighting: |
        #...
      #references:
        #-
  killchain: Credential Access
  att&ck:
    - T1552 #Unsecured Credentials
    - T1003 #OS Credential Dumping
    - T1555 #Credentials from Password Stores
  chaining:
    - relation: atomicity::implemented
      vector: b1593e0b-1b3b-462d-9ab6-21d1c136469d #Azure - Gather Resource Data
      description: |
        An adversary may obtain information and data within a resource.
    - relation: atomicity::implemented
      vector: 53f4e2f0-7d11-4629-bb26-905993a589db #Azure - Storage account reconnaissance
      description: |
        Adversaries need to scan and discover publicly accessible storage containers by 
        guessing or enumerating storage account and container names.
    - relation: support::enabled
      vector: 2743bf18-3b86-4721-bf3e-153dcda0b149 #Azure - Valid Credentials
      description: |
        Adversaries obtain the username and password of an AzureAD user either through phishing, 
        password spraying, brute-force attacks, or credentials leaked online.
    - relation: atomicity::implemented
      vector: 81338b90-f80c-40cc-8a57-ba97cdf86948 #Azure - Key Vault reconnaissance
      description: |
        Adversaries must first compromise user accounts, service principals, or managed 
        identities that already possess some level of Azure access.
    - relation: support::synergize
      vector: bcf3bb96-ed97-4853-98ab-937c2d214f4e #Azure - Key Vault persistence
      description: |
        Adversaries must first gain access to an Azure environment, typically through compromised 
        user accounts, service principals, or managed identities.
  #cve:
    #-
  #misp:
    #-
  domains:
    - Public Cloud
  terrain: |
    Adversaries obtains sufficient privileges (via phishing,
    misconfigurations, lateral movement, or exploitation of
    weak access controls).
  targets:
    - Key Store
    - Cloud Storage Accounts
  platforms:
    - Azure
    - Azure AD
  severity: Significant incident
  leverage:
    - Information Disclosure
    - Elevation of privilege
    - Modify privileges
  impact:
    - IP Loss
    - Reputational Damages
    - Identity Theft
    - Business disruption
  viability: Likely
  description: |
    The following threat vector involves adversaries accessing sensitive secrets, keys, 
    or credentials stored or used by Azure resources such as KeyVaults, Storage Accounts, 
    Automation Accounts, or within deployment histories.

    ### Example Attack Scenario

    An attacker with sufficient privileged access in Azure exploits misconfigured permissions, 
    allowing them to access a Storage Account and execute the `listkeys` action. This 
    reveals access keys that grant full control over the account's data. Alternatively, 
    by editing or viewing Azure Automation Account runbooks or Resource Group deployment 
    history, the attacker discovers embedded credentials or secrets used in automation 
    processes, which may then be used to escalate privileges or move laterally within 
    the environment.

    ### Attack Goals and Impact

    - **Primary goal:** Exfiltrate sensitive secrets, such as Storage Account access 
    keys, service principal credentials, KeyVault secrets, or any plaintext credentials 
    exposed in ARM templates or automation runbooks.
    - **Impact:** Once these secrets are exposed, attackers can impersonate service 
    identities, gain unauthorized access to data, break the integrity and confidentiality 
    of cloud services, or launch further attacks including data exfiltration, lateral 
    movement, persistence, or privilege escalation.

    ### Attack Flow and Methodology

    - **Reconnaissance:** Identifies potential resources containing secrets, such as 
    Storage Accounts, Automation Accounts, or deployment resource groups.
    - **Execution:** 
        - For Storage Accounts: Executes `Microsoft.Storage/storageAccounts/listkeys/action` 
        to dump access keys.
        - For Automation Accounts: Edits or reviews runbooks to extract embedded credentials.
        - For Resource Groups: Reads deployment history to extract secrets/credentials 
        embedded in ARM templates.
    - **Objective:** Uses the exfiltrated secrets to access additional resources, escalate 
    privileges, or maintain persistence in the Azure environment.
