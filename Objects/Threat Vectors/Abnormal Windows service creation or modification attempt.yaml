name: Abnormal Windows service creation or modification attempt
criticality: Medium
references:
  public:
    1: https://cdn2.hubspot.net/hubfs/3354902/Cybereason%20Labs%20Analysis%20Operation%20Cobalt%20Kitty.pdf # a document for Cobalt Strike Beacon
    2: https://windowsreport.com/event-id-7036/ # details related to the event: 7036
    3: https://superuser.com/questions/1517874/what-can-cause-a-windows-service-startup-type-to-change # details related to the event: 7040
    4: https://windowsreport.com/event-id-7045/ # details related to the event: 7045 
    5: https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=4697 # # details related to the event: 4697
  #internal:
    #a: 
  #restricted:
    #A: 
  #reports:
    #-

metadata:
  uuid: f16deda4-65b1-4825-8042-fe15524d0ce1
  schema: tvm::2.0
  version: 1
  created: 2023-02-07
  modified: 2024-05-23
  tlp: clear
  organisation:
    uuid: 56b0a0f0-b0bc-47d9-bb46-02f80ae2065a
    name: EC DIGIT CSOC


threat:
  actors:
    - name: att&ck::G0009 #[Enterprise] Deep Panda, Black Vine, KungFu Kittens, PinkPanther, Shell Crew, WebMasters
    - name: misp::066d25c1-71bd-4bd4-8ca7-edbba00063f4 #APT19, DEEP PANDA, Codoso, WebMasters, KungFu Kittens, Black Vine, TEMP.Avengers, Group 13, PinkPanther, Shell Crew, BRONZE FIRESTONE, G0009, G0073, Pupa, Sunshop Group
    - name: att&ck::G0050 #[Enterprise] APT32, APT-C-00, BISMUTH, Canvas Cyclone, OceanLotus, SeaLotus
    - name: misp::aa29ae56-e54b-47a2-ad16-d3ab0242d5d7 #APT32, OceanLotus Group, Ocean Lotus, OceanLotus, Cobalt Kitty, APT-C-00, SeaLotus, Sea Lotus, APT-32, APT 32, Ocean Buffalo, POND LOACH, TIN WOODLAWN, BISMUTH, ATK17, G0050, Canvas Cyclone
    - name: att&ck::G0082 #[Enterprise] APT38, BeagleBoyz, Bluenoroff, COPERNICIUM, NICKEL GLADSTONE, Sapphire Sleet, Stardust Chollima
    - name: misp::68391641-859f-4a9a-9a1e-3e5cf71ec376 #Lazarus Group, Operation DarkSeoul, Dark Seoul, Hidden Cobra, Hastati Group, Andariel, Unit 121, Bureau 121, NewRomanic Cyber Army Team, Bluenoroff, Subgroup: Bluenoroff, Group 77, Labyrinth Chollima, Operation Troy, Operation GhostSecret, Operation AppleJeus, APT38, APT 38, Stardust Chollima, Whois Hacking Team, Zinc, Appleworm, Nickel Academy, APT-C-26, NICKEL GLADSTONE, COVELLITE, ATK3, G0032, ATK117, G0082, Citrine Sleet, DEV-0139, DEV-1222, Diamond Sleet, ZINC, Sapphire Sleet, COPERNICIUM, TA404, Lazarus group, BeagleBoyz
    - name: att&ck::G0096 #[Enterprise] APT41, BARIUM, Brass Typhoon, Wicked Panda
    - name: misp::9c124874-042d-48cd-b72b-ccdc51ecbbd6 #APT41, G0096, TA415, Blackfly, Grayfly, LEAD, BARIUM, WICKED SPIDER, WICKED PANDA, BRONZE ATLAS, BRONZE EXPORT, Red Kelpie, G0044, Earth Baku, Amoeba, HOODOO, Brass Typhoon, Winnti, Double Dragon, TG-2633
  killchain: Persistence
  att&ck:
    - T1543.003 #Create or Modify System Process: Windows Service
    - T1112 #Modify Registry
    - T1055 #Process Injection
  domains:
    - Enterprise
    - Public Cloud
    - Private Cloud
  terrain: |
    An attacker has already compromised a Windows endpoint.  
  targets:
    - Workstations
    - Laptop
    - Control Server
    - Desktop
    - Input/Output Server
    - Public-Facing Servers
    - Web Application Servers
    - End-user
    - Other # Alter processes or their related threads 
  platforms:
    - Windows
    - Active Directory # The Domain Controller could be affected: service creaion or modification on it
  severity: Moderate incident
  leverage:
    - Modify configuration
    - Tampering
  impact:
    - Nuisance
    - Impairement
    - Lose Capabilities
  viability: Likely
  description: |
    A threat actor may attempt to create Windows services in order to start and
    run software or scripts that allow the threat actor to perform actions that
    controlling a Windows service allows to perform.   

    This may include: Establishing persistence, runnning cryptominers, 
    communicating with command&control, launching remote actions or moving 
    laterally.  

    Persistence using Windows service creation may be achieved in many ways, 
    see TVMs chained from this one.   

    Threat actors may try to evade detection by using well-known service names 
    or names that very closely resemble something that would look legit on a 
    Windows platform. For example  "WinHTTP Web Proxy Auto-Discovery" or 
    "TCP/IP NetBIOS Help" [CRN-01]  

    Some other example for creation/change of the current state of a service
    may appaear on a DC (Domain Controller). For example, events in the
    EventLog with ids: 7036, 7040, 7045 and 4697 indicate some of the possible
    creation or modification of services on a DC.  

    Creation or modification of a service on the system may lead to
    altering in the binaries and registries of the affected system.
    Such changes/modifications can also interfere with the other
    processes related to other services on the system. Each service
    has so called threads or sub-processes related to the main one.
    A change in one service or its thread can impact or compromise
    some of the related ones.    
