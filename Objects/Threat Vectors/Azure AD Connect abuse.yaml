name: Azure AD Connect abuse
criticality: High
references:
  public:
    1: https://www.sygnia.co/blog/guarding-the-bridge-new-attack-vectors-in-azure-ad-connect/
    2: https://www.threatngsecurity.com/glossary/azure-ad-connect-attacks
    3: https://cloudbrothers.info/en/azure-attack-paths/
    4: https://www.tevora.com/threat-blog/targeting-msol-accounts-to-compromise-internal-networks/
  #internal:
    #a: 

metadata:
  uuid: c698fc79-3ed6-44a7-a9d7-bc447600e4c3
  schema: tvm::2.1
  version: 3
  created: 2025-06-26
  modified: 2025-09-08
  tlp: clear
  #author: 
  #contributors:
    #-
  organisation:
    uuid: 56b0a0f0-b0bc-47d9-bb46-02f80ae2065a
    name: EC DIGIT CSOC

threat:
  #actors:
    #- name: 
      #sighting: |
        #...
      #references:
        #-
  killchain: Privilege Escalation
  att&ck:
    - T1556.007 #Modify Authentication Process: Hybrid Identity
    - T1098.001 #Account Manipulation: Additional Cloud Credentials
    - T1078.004 #Valid Accounts: Cloud Accounts
  chaining:
    - relation: support::enabled
      vector: 2743bf18-3b86-4721-bf3e-153dcda0b149 #Azure - Valid Credentials
      description: |
        Adversaries obtain the username and password of an AzureAD user either through phishing, 
        password spraying, brute-force attacks, or credentials leaked online.
  #cve:
    #-
  #misp:
    #-
  domains:
    - Public Cloud
  terrain: |
    Adversaries need local administrative access to the Azure AD Connect server.
  targets:
    - Identity Services
    - Cloud Storage Accounts
    - Workstations
    - Virtual Machines
    - API Endpoints
    - Cloud Portal
    - Server Authentication
    - Directory
    - Server Logs
  platforms:
    - Azure
    - Azure AD
    - Office 365 
  severity: Significant incident
  leverage:
    - Spoofing
    - Tampering
    - Repudiation
    - Information Disclosure
    - Elevation of privilege
    - Modify configuration   
  impact:
    - Data Breach
    - IP Loss
    - Reputational Damages
    - Lose Capabilities
    - Business disruption
    - Operating costs
  viability: Likely
  description: |
    Azure Active Directory (Azure AD) Connect abuse represents a critical threat vector 
    in hybrid identity environments, enabling attackers to pivot from on-premises Active 
    Directory to cloud environments. Below is a comprehensive analysis of the attack 
    methods, techniques, and implications based on current research.    

    ### Attack Vectors 

    **1. Credential Interception via MITM**  
    Attackers can perform man-in-the-middle (MITM) attacks against Azure AD Connect's 
    Password Hash Sync mechanism. By installing a rogue root CA certificate on the server 
    and proxying traffic, they intercept Azure AD Connector credentials sent to `login.microsoftonline.com`. 
    This enables extraction of NT hashes for domain users.  

    **2. Server Compromise and Malicious Synchronization**  
    Compromising the Azure AD Connect server (e.g., via phishing or exploits) allows attackers to:  
    - Synchronize malicious objects (e.g., privileged user accounts) to Azure AD.  
    - Elevate privileges in the cloud environment, gaining access to sensitive data 
    and configurations.    

    **3. Password Writeback Misconfiguration**  
    Misconfigured Password Writeback permissions (e.g., granting reset rights to privileged 
    on-premises accounts like Domain Admins) enables attackers to:  
    - Reset passwords of high-privilege accounts via Azure AD.  
    - Gain unauthorized access to on-premises resources (CVE-2017-8613).    

    **4. Pass-through Authentication (PTA) Abuse**  
    Attackers with access to the PTA agent server can:  
    - Use tools like **AADInternals** to intercept authentication requests.  
    - Register rogue PTA agents with compromised global admin credentials, harvesting 
    credentials during authentication.    

    **5. AZUREADSSOACC$ Account Exploitation**  
    Threat actors leverage the `AZUREADSSOACC$` account's NTLM hash to:  
    - Forge Kerberos tickets for synced users.  
    - Pivot to Azure AD, especially when synced Global Administrator accounts exist and 
    MFA is lax.    

    **6. MSOL Account Abuse**  
    The 'MSOL_[hash]' service account (used by Azure AD Connect) is a high-value target because it:  
    - Has extensive on-premises and cloud permissions (e.g., password reset, DCSync capabilities).  
    - Can reset passwords of synced admin accounts, leading to cloud and on-premises compromise. 
