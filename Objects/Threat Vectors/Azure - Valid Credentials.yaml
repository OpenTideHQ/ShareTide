name: Azure - Valid Credentials
criticality: High
references:
  public:
    1: https://cthfm-azure.gitbook.io/azure/mitre-att-and-ck/azure-mitre-frameworks/identity-provider-matrix-entra-id/initial-access-ta0001
    2: https://attack.mitre.org/techniques/T1078/
  #internal:
    #a: 

metadata:
  uuid: 2743bf18-3b86-4721-bf3e-153dcda0b149
  schema: tvm::2.1
  version: 2
  created: 2025-08-14
  modified: 2025-09-04
  tlp: clear
  organisation:
    uuid: 56b0a0f0-b0bc-47d9-bb46-02f80ae2065a
    name: EC DIGIT CSOC

threat:
  actors:
    - name: misp::5b4ee3ea-eee3-4c8e-8323-85ae32658754 #APT28, Pawn Storm, FANCY BEAR, Sednit, SNAKEMACKEREL, Tsar Team, TG-4127, STRONTIUM, Swallowtail, IRON TWILIGHT, Group 74, SIG40, Grizzly Steppe, G0007, ATK5, Fighting Ursa, ITG05, Blue Athena, TA422, T-APT-12, APT-C-20, UAC-0028, FROZENLAKE, Sofacy, Forest Blizzard, BlueDelta, Fancy Bear, GruesomeLarch
      sighting: |
        APT28 has used compromised Office 365 service accounts with Global Administrator privileges to collect email from user inboxes.
      references:
        - https://media.defense.gov/2021/Jul/01/2002753896/-1/-1/1/CSA_GRU_GLOBAL_BRUTE_FORCE_CAMPAIGN_UOO158036-21.PDF
    - name: misp::b2056ff0-00b9-482e-b11c-c771daa5f28a #APT29, Group 100, COZY BEAR, The Dukes, Minidionis, SeaDuke, YTTRIUM, IRON HEMLOCK, Grizzly Steppe, G0016, ATK7, Cloaked Ursa, TA421, Blue Kitsune, ITG11, BlueBravo, Nobelium, UAC-0029
      sighting: |
        APT29 has gained access to a global administrator account in Azure AD and has used Service Principal credentials in Exchange.
      references:
        - https://www.mandiant.com/resources/blog/apt29-continues-targeting-microsoft
        - https://www.mandiant.com/resources/blog/unc3524-eye-spy-email
    - name: misp::4f69ec6d-cb6b-42af-b8e2-920a2aa4be10 #APT33, APT 33, Elfin, MAGNALLIUM, Refined Kitten, HOLMIUM, COBALT TRINITY, G0064, ATK35, Peach Sandstorm, TA451
      sighting: |
        APT33 has used compromised Office 365 accounts in tandem with Ruler in an attempt to gain control of endpoints.
      references:
        - https://www.microsoft.com/security/blog/2020/06/18/inside-microsoft-threat-protection-mapping-attack-chains-from-cloud-to-endpoint/
    - name: misp::a47b79ae-7a0c-4308-9efc-294af19cc795 #APT5, KEYHOLE PANDA, MANGANESE, BRONZE FLEETWOOD, TEMP.Bottle, Mulberry Typhoon, Poisoned Flight
      sighting: |
        APT5 has accessed Microsoft M365 cloud environments using stolen credentials.
      references:
        - https://www.mandiant.com/resources/blog/updates-on-chinese-apt-compromising-pulse-secure-vpn-devices
    - name: misp::3b238f3a-c67a-4a9e-b474-dc3897e00129 #Scattered Spider, UNC3944, Muddled Libra, Oktapus, Scattered Swine, Scatter Swine, Octo Tempest, 0ktapus, Storm-0971, DEV-0971, Starfraud
      sighting: |
         Scattered Spider leveraged compromised credentials from victim users to authenticate to Azure tenants.
      references:
        - https://www.crowdstrike.com/blog/analysis-of-intrusion-campaign-targeting-telecom-and-bpo-companies/
    - name: misp::4f05d6c1-3fc1-4567-91cd-dd4637cc38b5 #HAFNIUM, ATK233, G0125, Operation Exchange Marauder, Red Dev 13, Silk Typhoon, MURKY PANDA
      sighting: |
        HAFNIUM has abused service principals in compromised environments to enable data exfiltration.
      references:
        - https://www.microsoft.com/en-us/security/blog/2025/03/05/silk-typhoon-targeting-it-supply-chain/
    - name: att&ck::G0004 #[Enterprise] Ke3chang, APT15, GREF, Mirage, NICKEL, Nylon Typhoon, Playful Dragon, RoyalAPT, Vixen Panda
      sighting: |
        Ke3chang has used compromised credentials to sign into victims’ Microsoft 365 accounts.
      references:
        - https://www.microsoft.com/security/blog/2021/12/06/nickel-targeting-government-organizations-across-latin-america-and-europe
    - name: misp::d9e5be22-1a04-4956-af6c-37af02330980 #LAPSUS, LAPSUS$, DEV-0537, SLIPPY SPIDER, Strawberry Tempest
      sighting: |
        LAPSUS$ has used compromised credentials to access cloud assets within a target organization.
      references:
        - https://www.microsoft.com/security/blog/2022/03/22/dev-0537-criminal-actor-targeting-organizations-for-data-exfiltration-and-destruction/
  killchain: Credential Access
  att&ck:
    - T1078.004 #Valid Accounts: Cloud Accounts
    - T1110 #Brute Force
    - T1555 #Credentials from Password Stores
  chaining:
    - relation: sequence::preceeds
      vector: a8c7b250-a2d4-4a0d-82f8-23dc99c77d7b #Addition credentials OAuth applications & service principals
      description: |
        Adversaries need to have gained a sufficient foothold in the  on-premises environment before starting to modify Azure Active Directory.
    - relation: sequence::preceeds
      vector: 66aafb61-9a46-4287-8b40-4785b42b77a3 #Adversary in the Middle phishing sites bypass MFA
      description: |
        An adversary needs to target companies and contacts to distribute the malware, it's used a massive distrigution technique on a random principle.
    - relation: sequence::preceeds
      vector: c698fc79-3ed6-44a7-a9d7-bc447600e4c3 #Azure AD Connect abuse
      description: |
        Adversaries need local administrative access to the Azure AD Connect server.
    - relation: sequence::preceeds
      vector: 5d43ef75-4637-4a75-b1ed-6716052cff0e #Azure app registration persistence
      description: |
        Adversaries need to compromise user or administrator credentials that have permissions to register or modify applications within Microsoft Entra ID.
    - relation: sequence::preceeds
      vector: 60c5b065-7d06-4697-850f-c2f80765f10b #Changes Azure infrastructure deployed through Azure CLI
      description: |
        A threat actor controls either privileged credentials or a service principal (SPN) and an endpoint from which Azure CLI can be run.
    - relation: sequence::preceeds
      vector: 6e988fa7-69c9-4aef-897c-a34fa5066dac #Ghost logins attempts
      description: |
        Application with SSO login requiring MFA, with legacy authentication (local login) not disabled. 
    - relation: sequence::preceeds
      vector: 78d5e363-14db-40c0-a1c4-4ba02a3e60d4 #Hijack Azure AD Applications
      description: |
        The threat actor first needs to compromise an account with a privileged directory role that was granted the ability to modify Enterprise Applications 
        or Application Registrations. 
    - relation: sequence::preceeds
      vector: 2fd1cddb-c66d-4a99-9779-31e32b67495e #Lateral movement abusing Azure Cross-Tenant Synchronization
      description: |
         Attackers must have compromised a tenant and gained elevated privileges.
    - relation: sequence::preceeds
      vector: 20bd3620-b13b-4895-b291-b1a26bd9aef3 #MS 365 admin compromised account
      description: |
        Attackers got valid credentials from MS 365 admin, and they manage to bypass 2FA mechanism.
    - relation: sequence::preceeds
      vector: f18be76e-f2b3-410a-80c5-d67e7b8e7b03 #Perform Microsoft Entra ID connectors MITM attack
      description: |
        The threat actors would need to access the credentials of the users or administrators interacting with the connectors.
    - relation: sequence::preceeds
      vector: 50c7e353-ac1c-48a7-8c98-2515b45f31f4 #Persistence through automation runbooks in Azure
      description: |
        Adversaries must have compromised credentials or accounts with sufficient permissions to create or modify Automation Accounts and runbooks.
    - relation: sequence::preceeds
      vector: 23f6a192-a25d-48b8-a235-7bb55e483682 #Persistence w/ Azure Automanage Machine Configuration
      description: |
        The adversary needs the owner access role on the targeted Azure Subscription to apply the Azure Policy and grant permissions for
        the system-managed identities.
  #cve:
    #-
  #misp:
    #-
  domains:
    - Public Cloud
  terrain: |
    Adversaries obtain the username and password of an AzureAD user either through phishing, 
    password spraying, brute-force attacks, or credentials leaked online.  
  targets:
    - Cloud Storage Accounts
    - Identity Services
    - Cloud Portal 
  platforms:
    - Azure
    - Azure AD
    - Office 365 
  severity: Significant incident
  leverage:
    - Spoofing
    - Tampering
    - Repudiation
    - Information Disclosure
    - Elevation of privilege
    - Modify configuration
    - Modify privileges
    - Modify data
  impact:
    - Data Breach
    - IP Loss
    - Reputational Damages
    - Identity Theft  
    - Lose Capabilities
    - Business disruption  
  viability: Likely
  description: |
    This threat vector within the Initial Access phase represents a significant risk 
    in Azure environments. This attack technique—formally designated around adversaries 
    acquiring and abusing legitimate authentication credentials to gain access to Azure 
    resources or Azure Active Directory (AzureAD).

    ### Example Attack Scenario

    - The attacker logs in directly to the Azure Portal or via CLI (e.g., `az login`) 
    using valid credentials.
    - Once inside, the attacker can enumerate resources, exfiltrate data, manipulate 
    configurations, or leverage the account for further attacks, depending on the permissions 
    granted to the compromised account.
    - If privileged service principal credentials are obtained, the attacker can use 
    secrets or certificates to automate access and escalate privileges.

    ### Attack Goals and Impact

    - **Primary Goals:**
      - Establish initial access to Azure environments in a stealthy, low-noise manner 
      by using valid, non-malicious authentication flows.
      - Access sensitive data, manipulate cloud resources, and potentially escalate 
      privileges or persist within the target environment.

    - **Impact:**
      - Complete compromise of Azure resources accessible by the stolen account (files, 
      databases, VMs, identity services, etc.).
      - Potential for privilege escalation if the account is eligible for higher roles 
      or Privileged Identity Management (PIM).
      - Ability to create backdoors, perform lateral movement, and evade detection (since 
      all actions appear legitimate).
      - Depending on account privileges, ransomware deployment, data exfiltration, and 
      broad access to organizational assets may occur.

    ### Attack Flow and Methodology

    1. **Reconnaissance**
      - Attackers gather information on users or service principals, identifying potential 
      targets through open-source intelligence, misconfigurations, or enumeration of 
      publicly accessible resources.

    2. **Credential Acquisition**
      - Common methods: phishing (email/SMS/voice), brute-force/password spraying, 
      harvesting credentials from previous breaches, or exploiting cloud API/application 
      misconfigurations.
      - Service principal secrets/certificates may be obtained from publicly accessible 
      repositories, misconfigured code, or automation scripts.

    3. **Authentication**
      - Adversary logs into Azure Portal or invokes cloud APIs using the acquired credentials.
      - For service principals: authentication occurs via CLI or programmatic access 
      using certificates/secrets.

    4. **Enumeration and Expansion**
      - Mapping out resources, roles, permissions; searching for sensitive data or 
      additional high-value targets.
      - Assessing role activation and privilege escalation opportunities (e.g., via 
      PIM or RBAC misconfigurations).

    5. **Execution of Attack Objectives**
      - Data exfiltration, sabotage, account persistence (creating additional user 
      accounts or credentials), lateral movement to other resources, or exploitation 
      for financial gain.
      - Actions are typically performed under the guise of the legitimate account to 
      avoid detection.

    6. **Persistence and Defense Evasion**
      - Adversaries may create new accounts, modify access policies, or abuse automation 
      to ensure continued access.
      - Use of valid credentials enables attackers to blend with legitimate user activity, 
      thus evading many traditional security detection systems.
