name: Self-Service Password Reset (SSPR) abuse in Azure AD
criticality: Medium
references:
  public:
    1: https://learn.microsoft.com/en-us/entra/identity/authentication/concept-sspr-howitworks
    2: https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/the-adventure-continues-azure-ad-self-service-password-reset/ba-p/810776
    3: https://danielchronlund.com/2019/08/26/measure-your-azure-ad-mfa-and-self-service-password-reset-success/
    4: https://www.obsidiansecurity.com/blog/behind-the-breach-self-service-password-reset-azure-ad/ 
  #internal:
    #a: 
  #reports:
    #-

metadata:
  uuid: a1a17bd4-ec7e-4302-aedf-96ee7c436065
  schema: tvm::2.0
  version: 1
  created: 2024-10-23
  modified: 2024-11-13
  tlp: clear
  organisation:
    uuid: 56b0a0f0-b0bc-47d9-bb46-02f80ae2065a
    name: EC DIGIT CSOC

threat:
  actors:
    - name: att&ck::G1004 #[Enterprise] LAPSUS$, DEV-0537, Strawberry Tempest
    - name: misp::d9e5be22-1a04-4956-af6c-37af02330980 #LAPSUS, LAPSUS$, DEV-0537, SLIPPY SPIDER, Strawberry Tempest
    - name: att&ck::G0016 #[Enterprise] APT29, Blue Kitsune, Cozy Bear, CozyDuke, Dark Halo, IRON HEMLOCK, IRON RITUAL, Midnight Blizzard, NOBELIUM, NobleBaron, SolarStorm, The Dukes, UNC2452, UNC3524, YTTRIUM
    - name: misp::2ee5ed7a-c4d0-40be-a837-20817474a15b #UNC2452, DarkHalo, StellarParticle, NOBELIUM, Solar Phoenix, Midnight Blizzard
  killchain: Credential Access
  att&ck:
    - T1621 #Multi-Factor Authentication Request Generation
  chaining:
    - relation: sequence::succeeds
      vector: 6a7a493a-511a-4c9d-aa9c-4427c832a322 ##SIM-card swapping
      description: |
        After swap the SIM card of the user, attackers can go for the SPPR in Azure AD
    - relation: atomicity::implements
      vector: 4a807ac4-f764-41b1-ae6f-94239041d349 #MFA Bypass Techniques
      description: |
        MFA bypass technique
  #cve:
    #-
  #misp:
    #-
  domains:
    - Enterprise
    - Mobile
    - Public Cloud
  terrain: |
    The administrator of the targeted Azure tenant must have SSPR enabled.
  targets:
    - Auth token
    - Cloud Portal
    - End-user
    - Identity Services
    - Mobile phone
  platforms:
    - EU Login
    - Android
    - iOS
    - Azure AD
  severity: Moderate incident
  leverage:
    - Elevation of privilege
    - Spoofing
    - Modify configuration
  impact:
    - Impairement
    - Identity Theft
  viability: Unlikely
  description: |
    Self-service password reset (SSPR) is an Azure AD feature that allows users to
    reset their password without the involvement of an administrator or help desk. 
    It is designed for convenience and productivity so that users who forgot their
    password or get locked out can easily reset it themselves with minimal friction.

    Administrators are able to configure SSPR for the entire organization or a subset 
    of groups via the Azure portal. They can also define requirements for permitted 
    forms of verification and the number of verification methods required to perform 
    the reset.

    ## methods

    There are two primary methods through which adversaries have been abusing this tool:

    - SIM swapping to gain initial access
    - Attacker registered MFA to establish persistence

    SIM swapping is an increasingly popular tactic that adversaries use to take 
    control of a target phone number. This typically involves social engineering a
    mobile carrier in order to initiate a number transfer to a new SIM card or
    bribing internal employees to execute a swap. 

    If an adversary controls the card and the organization SSPR is configured to
    only require a single verification method, attackers should have no problem 
    establishing initial access and enroll their own MFA methods for persistence,
    typically mobile authenticator applications or disposable emails.


    ## reconnaisance

    Successful SIM swapping needs sufficient preliminary SSPR reconnaissance to
    identify a viable target. Aside from requiring the information to social engineer
    a mobile carrier, the adversary needs to determine whether or not the target is
    even susceptible to SSPR abuse.

    Given any email address, it is easy to validate if it is a valid Microsoft 365 
    account. The below curl command can be used to determine if a given email address
    is a managed account in Microsoft 365:

    curl -s -X POST https:///login.microsoftonline.com/common/GetCrede... –data ‘{“Username”:”user@domain.com”}’

    Once valid Microsoft 365 accounts are identified, attackers initiate the SSPR flow
    to see which verification options are available. Attackers likely need to perform
    this recon as well if they are going to spend the time and effort performing the
    initial SIM swap.

    The Microsoft interface that appears during a SSPR clearly indicates whether one 
    or two verification methods are required, making it easier for attackers to select
    vulnerable target accounts. 
