name: Scheduled tasks created with command line
criticality: Medium
references:
  public:
    1: https://redcanary.com/threat-detection-report/techniques/scheduled-task/
    2: https://learn.microsoft.com/en-us/troubleshoot/windows-client/system-management-components/use-at-command-to-schedule-tasks
    3: https://attack.mitre.org/techniques/T1053/005/
    4: https://attack.mitre.org/software/S0111/
    5: https://redcanary.com/threat-detection-report/techniques/windows-command-shell/
    6: https://www.windowscentral.com/how-create-task-using-task-scheduler-command-prompt
  #internal:
    #a: 
  #restricted:
    #A: 
  #reports:
    #-

metadata:
  uuid: 2b560980-d4c6-428c-963f-697e7e29938c
  schema: tvm::2.0
  tlp: clear
  version: 4
  created: 2022-12-09
  modified: 2022-12-13
  organisation:
    uuid: 56b0a0f0-b0bc-47d9-bb46-02f80ae2065a
    name: EC DIGIT CSOC

threat:
  actors:
    - name: att&ck::G0092 #[Enterprise] TA505, CHIMBORAZO, Hive0065, Spandex Tempest
    - name: misp::03c80674-35f8-4fe0-be2b-226ed0fcd69f #TA505, SectorJ04, SectorJ04 Group, GRACEFUL SPIDER, GOLD TAHOE, Dudear, G0092, ATK103, Hive0065, CHIMBORAZO, Spandex Tempest
  killchain: Execution
  att&ck:
    - T1053.005
  domains:
    - Enterprise
    - Public Cloud
  terrain: |
    An adversary has gained control over a Windows endpoint and has  
    privileges to create scheduled tasks using the command line.
  targets:
    - Workstations
    - Control Server
    - Input/Output Server
    - Laptop
    - Desktop
    - Remote access
    - Web Application Servers
    - Public-Facing Servers
  platforms:
    - Windows
  severity: Moderate incident
  leverage:
    - Elevation of privilege
    - Infrastructure Compromise
    - Dwelling
  impact:
    - Impairement
  viability: Likely
  description: |
    Adversaries can use  Windows Command Shell (cmd.exe) to execute specific commands 
    to create scheduled tasks for the purposes of dwelling, execution of binaries, 
    or for communication to Command and Control server infrastructure.


    Examples for creation of a scheduled task via command-line interface:

    1. Create a daily task to run at specific time:

       SCHTASKS /CREATE /SC DAILY /TN "FOLDERPATH\TASKNAME" /TR "C:\SOURCE\FOLDER\APP-OR-SCRIPT" /ST HH:MM
  
    The folder path before the task name, under the /TN option, is not a requirement, 
    but it'll help to keep the tasks separated. If the path is not specified, the task 
    will be created inside the Task Scheduler Library folder.

    2. Create a weekly task to run at specific time:

      SCHTASKS /CREATE /SC WEEKLY /D SUN /TN "FOLDERPATH\TASKNAME" /TR "C:\SOURCE\FOLDER\APP-OR-SCRIPT" /ST HH:MM
    
    3. Create monthly task to run at specific time:

      SCHTASKS /CREATE /SC MONTHLY /D 15 /TN "FOLDERPATH\TASKNAME" /TR "C:\SOURCE\FOLDER\APP-OR-SCRIPT" /ST HH:MM
    
    4. Create a scheduled task that runs daily as a specific user:
    
      SCHTASKS /CREATE /SC DAILY /TN "FOLDERPATH\TASKNAME" /TR "C:\SOURCE\FOLDER\APP-OR-SCRIPT" /ST HH:MM

    Parameters that can be used in creation scheduled task command:

     /CREATE - specifies the creation a new automated routine task
     /SC - define the schedule of the task, for example it can include
     MINUTE, HOURLY, DAILY, WEEKLY, MONTHLY, ONCE, ONSTART, ONLOGON, ONIDLE, and ONEVENT.
     /D — specifies the day of the week to execute the task. (examples MON, TUE and etc)
     /TN — specifies the task name and location, the task can be created in a specific
     location directory (example /TN "FOLDERPATH\TASKNAME")
     /ST — defines the time to run the task (in 24 hours format)
     /RU — specifies the task to run under a specific user account.
     /QUERY — displays all the system tasks.



    
