name: Azure - Gather Resource Data
criticality: High
references:
  public:
    1: https://microsoft.github.io/Azure-Threat-Research-Matrix/Reconnaissance/AZT107/AZT107/
    2: https://techcommunity.microsoft.com/blog/microsoftsecurityexperts/cloud-forensics-why-enabling-microsoft-azure-key-vault-logs-matters/4432149
    3: https://www.bdosecurity.de/en-gb/insights/security-column/cloud-hacking-the-azure-cyber-kill-chain-part-1
  #internal:
    #a: 

metadata:
  uuid: b1593e0b-1b3b-462d-9ab6-21d1c136469d
  schema: tvm::2.1
  version: 1
  created: 2025-08-07
  modified: 2025-08-12
  tlp: clear
  #author: 
  #contributors:
    #-
  organisation:
    uuid: 56b0a0f0-b0bc-47d9-bb46-02f80ae2065a
    name: EC DIGIT CSOC

threat:
  actors:
    - name: misp::f02679fa-5e85-4050-8eb5-c2677d93306f #Volt Typhoon, BRONZE SILHOUETTE, VANGUARD PANDA, UNC3236, Insidious Taurus, VOLTZITE, Dev-0391, Storm-0391
      sighting: |
        Volt Typhoon has conducted pre-compromise reconnaissance for victim resource information.
      references:
        - https://www.cisa.gov/sites/default/files/2024-03/aa24-038a_csa_prc_state_sponsored_actors_compromise_us_critical_infrastructure_3.pdf
    - name: misp::4f05d6c1-3fc1-4567-91cd-dd4637cc38b5 #HAFNIUM, ATK233, G0125, Operation Exchange Marauder, Red Dev 13, Silk Typhoon, MURKY PANDA
      sighting: |
        HAFNIUM has interacted with Office 365 tenants to gather details regarding target's environments.
      references:
        - https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/
    - name: misp::60fa684d-c738-4b77-98fb-3f6605e2bb82 #FIN13, TG2003, Elephant Beetle
      sighting: |
        FIN13 has searched for infrastructure that can provide remote access to an environment for targeting efforts.
      references:
        - https://www.mandiant.com/resources/blog/fin13-cybercriminal-mexico
    - name: att&ck::G1045 #[Enterprise] Salt Typhoon
      sighting: |
        Salt Typhoon has used configuration files from exploited network devices to help discover upstream and downstream network segments.
      references:
        - https://blog.talosintelligence.com/salt-typhoon-analysis/
  #killchain: 
  att&ck:
    - T1526 #Cloud Service Discovery
    - T1087 #Account Discovery
    - T1552.001 #Unsecured Credentials: Credentials In Files
    - T1530 #Data from Cloud Storage
  chaining:
    - relation: sequence::succeeds
      vector: f9a6f927-d08c-40c1-85af-01331c471def #Phishing w/ Azure AD B2B Collaboration
      description: |
        An adversary may obtain information and data within a resource.
    - relation: sequence::succeeds
      vector: 66aafb61-9a46-4287-8b40-4785b42b77a3 #Adversary in the Middle phishing sites bypass MFA
      description: |
        An adversary may obtain information and data within a resource.
    - relation: sequence::succeeds
      vector: 9bb31c65-8abd-48fc-afe3-8aca76109737 #Modify Azure federation trust accept externally signed tokens
      description: |
        An adversary may obtain information and data within a resource.
  #cve:
    #-
  #misp:
    #-
  domains:
    - Public Cloud
    - Private Cloud
  terrain: |
    The attacker obtains credentials (via phishing, password spray, leaked keys) granting 
    at least Reader access to the target Azure tenant.
  targets:
    - Cloud Storage Accounts
    - Key Store
    - Virtual Machines
    - Identity Services
    - Compute Cluster
    - Public-Facing Servers
    - Network Equipment
    - Serverless
    - API Endpoints
    - Cloud Portal
    - Relational Database
    - NoSQL Database
    - Microservices
    - SAML-Joined Applications
  platforms:
    - Azure
    - Azure AD
    - Windows
    - Linux
    - PowerShell 
  severity: Significant incident
  leverage:
    - Information Disclosure
    - Infrastructure Compromise
    - Elevation of privilege
    - Modify configuration
    - Modify privileges
    - Modify data
  impact:
    - Data Breach
    - IP Loss
    - Reputational Damages
    - Identity Theft
    - Monetary Loss
    - Business disruption
    - Operating costs
  viability: Likely
  description: |
    The “Gather Resource Data” technique is a key part of the reconnaissance phase in 
    attacks against Azure environments. This activity focuses on enumerating information 
    about resources within a target Azure tenant or subscription to support subsequent 
    attack phases.

    #### Example Attack Scenario

    A threat actor gains access to a compromised identity in an Azure environment, such 
    as via phishing or a leaked credential. Using this access, the attacker enumerates 
    accessible resources (e.g., virtual machines, storage accounts, databases, and identity 
    configurations) by executing read operations like `{resource}/*/read`. For example, 
    if the account has Reader or even limited permissions, the attacker can list resource 
    groups, virtual machines, Key Vaults, storage accounts, and see details such as 
    configurations, names, and metadata. They might also list the names of secrets or 
    certificates in a Key Vault—while unable to access the contents without elevated 
    permissions, this reconnaissance helps prioritize attack targets.

    #### Attack Goals and Impact

    - **Goals:**
      - Develop a comprehensive map of the organization’s Azure environment.
      - Identify high-value resources (e.g., storage accounts with sensitive data, Key 
      Vaults, privileged identities).
      - Find weakly configured, over-permitted, or exposed resources (public endpoints, 
      misconfigured access policies).
      - Inform next stages of the attack (privilege escalation, lateral movement, data theft).

    - **Potential Impact:**
      - **Accelerated compromise:** With detailed resource and configuration information, 
      attackers can quickly focus on the most lucrative or vulnerable targets.
      - **Increased stealth:** Attackers can tailor subsequent steps to avoid detection—targeting 
      overlooked or poorly monitored resources.
      - **Data exposure:** Identification of exposed storage or secrets can result in 
      immediate or subsequent sensitive data breaches.

    #### Attack Flow and Methodology

    1. **Automated Enumeration:** Utilizing Azure CLI, PowerShell (e.g., `Get-AzResource`, `az resource list`), 
    REST APIs, or scripts, the attacker lists:
      - Resource groups and their contents
      - Virtual machines, storage accounts, databases, and Key Vaults
      - Permissions and access policies associated with resources
    2. **Asset Profiling:** The attacker collects details on configurations, public IPs, 
    RBAC permissions, and metadata for each resource.
    3. **Vulnerability Identification:** Analysis focuses on resources where permissions, 
    network exposure, or configurations suggest potential for privilege escalation or data access.
    4. **Preparation for Next Stages:** The attacker plans lateral movement, privilege 
    escalation, or direct attacks on data, using the knowledge obtained to target weak points.
