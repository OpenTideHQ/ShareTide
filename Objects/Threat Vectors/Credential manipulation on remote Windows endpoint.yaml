name: Credential manipulation on remote Windows endpoint
criticality: Medium
references:
  public:
    1: https://pypi.org/project/pypsexec/
    2: https://stackoverflow.com/questions/24963625/psexec-run-python-script-passed-from-host
    3: https://nv2lt.github.io/windows/smb-psexec-smbexec-winexe-how-to/
    4: https://pentestlab.blog/2018/04/04/dumping-clear-text-credentials/
    5: https://blogs.blackberry.com/en/2022/10/mustang-panda-abuses-legitimate-apps-to-target-myanmar-based-victims
    6: https://learn.microsoft.com/en-us/sysinternals/downloads/psexec
    7: https://www.sentinelone.com/cybersecurity-101/mimikatz/
    8: https://www.cisa.gov/uscert/ncas/alerts/aa22-011a
    9: https://resources.infosecinstitute.com/topic/apt-sandworm-notpetya-technical-overview/
    10: https://www.avertium.com/resources/threat-reports/in-depth-iranian-apt-muddywater
  #internal:
    #a: 
  #restricted:
    #A: 
  #reports:
    #-

metadata:
  uuid: cfc6369a-e3df-4827-bb0d-969342f1558c
  schema: tvm::2.0
  tlp: clear
  version: 6
  created: 2023-01-27
  modified: 2023-02-07
  organisation:
    uuid: 56b0a0f0-b0bc-47d9-bb46-02f80ae2065a
    name: EC DIGIT CSOC

threat:
  actors:
    - name: att&ck::G0034 #[Enterprise] Sandworm Team, APT44, BlackEnergy (Group), ELECTRUM, FROZENBARENTS, IRIDIUM, IRON VIKING, Quedagh, Seashell Blizzard, Telebots, Voodoo Bear
    - name: misp::d52ca4c4-d214-11e8-8d29-c3e7cb78acce #GreyEnergy
    - name: att&ck::G0069 #[Enterprise] MuddyWater, Earth Vetala, MERCURY, Mango Sandstorm, Seedworm, Static Kitten, TA450, TEMP.Zagros
    - name: misp::a29af069-03c3-4534-b78b-7d1a77ea085b #MuddyWater, TEMP.Zagros, Static Kitten, Seedworm, MERCURY, COBALT ULSTER, G0069, ATK51, Boggy Serpens, Mango Sandstorm, TA450, Earth Vetala
    - name: att&ck::G0129 #[Enterprise] Mustang Panda, BRONZE PRESIDENT, RedDelta, TA416
    - name: misp::fceed509-938e-4f9e-acd4-76e6c28dc6f1 #RedDelta
  killchain: Execution
  #Delivery
  att&ck:
    - T1098.001
    - T1003
  domains:
    - Enterprise
    - Private Cloud
    - Public Cloud
  terrain: |
    Requires an already compromised Windows endpoint.
  targets:
    - Workstations
    - Desktop
    - Laptop
    - End-user
    - Email Platform
    - Control Server
    - Remote access
    - System admin
    - Public-Facing Servers
    - Web Application Servers
  platforms:
    - Windows
    - Active Directory
    - PowerShell
  severity: Moderate incident
  leverage:
    - Tampering
  impact:
    - Nuisance
  viability: Likely
  description: |
    Threat actors can perform credential manipulation on a remote Windows
    endpoint with a variety of tools like: Mimikatz, WMIExec, WinRM-based,
    PsExec, SMBExec or PowerShell or others to extract credentials from
    a credential storage point on the endpoint, as example from the endpoint's
    memory. This can be done by an attacker who already has gained access to
    and control of one endpoint.
    
    Requirements:

    - permissions to access the remote machine
    - permission/ability to run credential dumping tools
    - or an ability to start a service remotely
    
    Impacket PsExec example with username and password:

    python3 psexec.py <domain>/<user>:<pass>@<target_host>

    or an option with NTLM hashes

    python3 psexec.py -hashes <lmhash>:<ntlmhash> <domain>/<user>@<target_host>

    Example for Impacket SMBExec with plaintext credentials and NTLM hashes:

    python3 smbexec.py "<domain>/<user>:<password>"@<target_host>

    python3 smbexec.py -hashes <lmhash>:<ntlmhash> <domain>/<user>@<target_host>

    Impacket suite contains a python script and can read the content of the
    registry keys and decrypt the LSA Secrets passwords.

    Example:

    impacket-secretdump -sam /root/Desktop/sam.save -security /root/Desktop/security.save -system /root/Desktop/system.save LOCAL

